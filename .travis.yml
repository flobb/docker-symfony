language: bash
services: docker

branches:
  only:
    - master

env:
  - FOLDER=8.0/buster/zts TAGS=8.0-zts,8.0.9-zts,8.0-buster-zts,8.0.9-buster-zts
  - FOLDER=8.0/buster/fpm TAGS=8.0-fpm,8.0.9-fpm,8.0-buster-fpm,8.0.9-buster-fpm
  - FOLDER=8.0/alpine3.14/fpm TAGS=8.0-alpine-fpm,8.0.9-alpine-fpm,8.0-alpine3.14-fpm,8.0.9-alpine3.14-fpm
  - FOLDER=8.0/alpine3.13/fpm TAGS=8.0-alpine3.13-fpm,8.0.9-alpine3.13-fpm
  - FOLDER=8.0/buster/cli TAGS=8.0,8.0.9,8.0-cli,8.0.9-cli,8.0-buster,8.0.9-buster,8.0-buster-cli,8.0.9-buster-cli
  - FOLDER=8.0/alpine3.14/cli TAGS=8.0-alpine,8.0.9-alpine,8.0-alpine-cli,8.0-alpine3.14,8.0.9-alpine-cli,8.0.9-alpine3.14,8.0-alpine3.14-cli,8.0.9-alpine3.14-cli
  - FOLDER=8.0/alpine3.13/cli TAGS=8.0-alpine3.13,8.0.9-alpine3.13,8.0-alpine3.13-cli,8.0.9-alpine3.13-cli
  - FOLDER=8.0/buster/apache TAGS=8.0-apache,8.0.9-apache,8.0-buster-apache,8.0.9-buster-apache
  - FOLDER=7.4/buster/zts TAGS=7.4-zts,7.4.22-zts,7.4-buster-zts,7.4.22-buster-zts
  - FOLDER=7.4/alpine3.14/zts TAGS=7.4-alpine-zts,7.4.22-alpine-zts,7.4-alpine3.14-zts,7.4.22-alpine3.14-zts
  - FOLDER=7.4/alpine3.13/zts TAGS=7.4-alpine3.13-zts,7.4.22-alpine3.13-zts
  - FOLDER=7.4/buster/fpm TAGS=7.4-fpm,7.4.22-fpm,7.4-buster-fpm,7.4.22-buster-fpm
  - FOLDER=7.4/alpine3.14/fpm TAGS=7.4-alpine-fpm,7.4.22-alpine-fpm,7.4-alpine3.14-fpm,7.4.22-alpine3.14-fpm
  - FOLDER=7.4/alpine3.13/fpm TAGS=7.4-alpine3.13-fpm,7.4.22-alpine3.13-fpm
  - FOLDER=7.4/buster/cli TAGS=7.4,7.4.22,7.4-cli,7.4.22-cli,7.4-buster,7.4.22-buster,7.4-buster-cli,7.4.22-buster-cli
  - FOLDER=7.4/alpine3.14/cli TAGS=7.4-alpine,7.4.22-alpine,7.4-alpine-cli,7.4-alpine3.14,7.4.22-alpine-cli,7.4.22-alpine3.14,7.4-alpine3.14-cli,7.4.22-alpine3.14-cli
  - FOLDER=7.4/alpine3.13/cli TAGS=7.4-alpine3.13,7.4.22-alpine3.13,7.4-alpine3.13-cli,7.4.22-alpine3.13-cli
  - FOLDER=7.4/buster/apache TAGS=7.4-apache,7.4.22-apache,7.4-buster-apache,7.4.22-buster-apache
  - FOLDER=7.3/buster/zts TAGS=7.3-zts,7.3.29-zts,7.3-buster-zts,7.3.29-buster-zts
  - FOLDER=7.3/alpine3.14/zts TAGS=7.3-alpine-zts,7.3.29-alpine-zts,7.3-alpine3.14-zts,7.3.29-alpine3.14-zts
  - FOLDER=7.3/alpine3.13/zts TAGS=7.3-alpine3.13-zts,7.3.29-alpine3.13-zts
  - FOLDER=7.3/buster/fpm TAGS=7.3-fpm,7.3.29-fpm,7.3-buster-fpm,7.3.29-buster-fpm
  - FOLDER=7.3/alpine3.14/fpm TAGS=7.3-alpine-fpm,7.3.29-alpine-fpm,7.3-alpine3.14-fpm,7.3.29-alpine3.14-fpm
  - FOLDER=7.3/alpine3.13/fpm TAGS=7.3-alpine3.13-fpm,7.3.29-alpine3.13-fpm
  - FOLDER=7.3/buster/cli TAGS=7.3,7.3.29,7.3-cli,7.3.29-cli,7.3-buster,7.3.29-buster,7.3-buster-cli,7.3.29-buster-cli
  - FOLDER=7.3/alpine3.14/cli TAGS=7.3-alpine,7.3.29-alpine,7.3-alpine-cli,7.3-alpine3.14,7.3.29-alpine-cli,7.3.29-alpine3.14,7.3-alpine3.14-cli,7.3.29-alpine3.14-cli
  - FOLDER=7.3/alpine3.13/cli TAGS=7.3-alpine3.13,7.3.29-alpine3.13,7.3-alpine3.13-cli,7.3.29-alpine3.13-cli
  - FOLDER=7.3/buster/apache TAGS=7.3-apache,7.3.29-apache,7.3-buster-apache,7.3.29-buster-apache

script:
  - cd $FOLDER
  - IMAGESLIST=()
  - IFS=, read -a TAGSLIST <<< "$TAGS"
  - docker build .
  - |
    for TAG in "${TAGSLIST[@]}"
    do
      IMAGE="solune/symfony:${TAG}"
      docker build . -t "${IMAGE}"
      IMAGESLIST+=("${IMAGE}")
    done
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - |
    for IMAGE in "${IMAGESLIST[@]}"
    do
      echo "Pushing $IMAGE to the registry"
      docker push "${IMAGE}"
    done
